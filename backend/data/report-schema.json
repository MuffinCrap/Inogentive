{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Weekly Report",
  "description": "Schema for weekly executive reports generated by the automation system",
  "type": "object",
  "required": ["id", "date", "status", "recipients", "content"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the report",
      "pattern": "^[a-z0-9]{8,16}$"
    },
    "date": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the report was generated"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "sent", "failed"],
      "description": "Current status of the report"
    },
    "recipients": {
      "type": "array",
      "description": "List of email addresses the report was sent to",
      "items": {
        "type": "string",
        "format": "email"
      },
      "minItems": 0
    },
    "content": {
      "type": "string",
      "description": "The full report content in Markdown format"
    },
    "triggerType": {
      "type": "string",
      "enum": ["manual", "scheduled"],
      "description": "How the report generation was triggered"
    },
    "weekEnding": {
      "type": "string",
      "format": "date",
      "description": "The end date of the week this report covers"
    },
    "metrics": {
      "type": "object",
      "description": "Key metrics extracted from Power BI",
      "properties": {
        "totalRevenue": {
          "type": "number",
          "description": "Total revenue for the week"
        },
        "revenueWoW": {
          "type": "number",
          "description": "Week-over-week revenue change percentage"
        },
        "conversionRate": {
          "type": "number",
          "description": "Conversion rate percentage"
        },
        "conversionWoW": {
          "type": "number",
          "description": "Week-over-week conversion rate change"
        },
        "avgTransactionValue": {
          "type": "number",
          "description": "Average transaction value"
        },
        "atvWoW": {
          "type": "number",
          "description": "Week-over-week ATV change percentage"
        },
        "storeTraffic": {
          "type": "integer",
          "description": "Total store traffic count"
        },
        "trafficWoW": {
          "type": "number",
          "description": "Week-over-week traffic change percentage"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata about the report",
      "properties": {
        "generationTimeMs": {
          "type": "integer",
          "description": "Time taken to generate the report in milliseconds"
        },
        "llmModel": {
          "type": "string",
          "description": "The LLM model used for analysis"
        },
        "llmTokensUsed": {
          "type": "integer",
          "description": "Number of tokens used in LLM call"
        },
        "dataExtractedAt": {
          "type": "string",
          "format": "date-time",
          "description": "When the Power BI data was extracted"
        },
        "emailSentAt": {
          "type": "string",
          "format": "date-time",
          "description": "When the email was sent"
        },
        "version": {
          "type": "string",
          "description": "Version of the report generation system"
        }
      }
    }
  }
}
